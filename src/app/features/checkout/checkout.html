<div class="checkout-page">
  <div class="container">
    @if (orderSuccess) {
      <div class="success-card">
        <div class="success-icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="#00c853" stroke-width="2">
            <path d="M22 11.08V12a10 10 0 11-5.93-9.14"/>
            <polyline points="22 4 12 14.01 9 11.01"/>
          </svg>
        </div>
        <h1>Pedido Realizado!</h1>
        <p>Tu pedido #{{ orderId }} ha sido registrado exitosamente.</p>
        <p class="sub-text">Metodo de pago: Transferencia bancaria. Nos comunicaremos contigo para coordinar el pago.</p>
        @if (whatsappUrl) {
          <a [href]="whatsappUrl" target="_blank" class="btn-whatsapp">Enviar por WhatsApp</a>
        }
        <a routerLink="/home" class="btn-home">Volver al inicio</a>
      </div>
    } @else {
      <h1 class="page-title">Checkout</h1>

      <div class="checkout-layout">
        <form (ngSubmit)="onSubmit()" #checkoutForm="ngForm" class="checkout-form">
          <h2>Datos de contacto</h2>

          <div class="form-row">
            <div class="form-group">
              <label for="nombre">Nombre</label>
              <input type="text" id="nombre" name="nombre" [(ngModel)]="form.nombre" required>
            </div>
            <div class="form-group">
              <label for="apellidos">Apellidos</label>
              <input type="text" id="apellidos" name="apellidos" [(ngModel)]="form.apellidos" required>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="email">Email</label>
              <input type="email" id="email" name="email" [(ngModel)]="form.email" required>
            </div>
            <div class="form-group">
              <label for="telefono">Telefono</label>
              <input type="tel" id="telefono" name="telefono" [(ngModel)]="form.telefono" required placeholder="10 digitos">
            </div>
          </div>

          <h2>Direccion de envio</h2>

          <div class="form-group">
            <label for="calle">Calle y numero</label>
            <input type="text" id="calle" name="calle" [(ngModel)]="form.calle" required>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="colonia">Colonia</label>
              <input type="text" id="colonia" name="colonia" [(ngModel)]="form.colonia" required>
            </div>
            <div class="form-group">
              <label for="cp">Codigo Postal</label>
              <input type="text" id="cp" name="codigo_postal" [(ngModel)]="form.codigo_postal" required maxlength="5">
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="ciudad">Ciudad</label>
              <input type="text" id="ciudad" name="ciudad" [(ngModel)]="form.ciudad" required>
            </div>
            <div class="form-group">
              <label for="estado">Estado</label>
              <input type="text" id="estado" name="estado" [(ngModel)]="form.estado" required>
            </div>
          </div>

          <div class="form-group">
            <label for="referencias">Referencias</label>
            <textarea id="referencias" name="referencias" [(ngModel)]="form.referencias" rows="2" placeholder="Referencias del domicilio"></textarea>
          </div>

          <button type="submit" class="btn-submit" [disabled]="checkoutForm.invalid || loading">
            @if (loading) {
              Procesando pedido...
            } @else {
              Confirmar Pedido
            }
          </button>
        </form>

        <div class="order-summary">
          <h3>Resumen del pedido</h3>
          @for (item of cartService.cartItems(); track item.id_producto) {
            <div class="summary-item">
              <span class="item-name">{{ item.nombre }} x{{ item.cantidad }}</span>
              <span>{{ item.precio * item.cantidad | currency:'MXN':'symbol-narrow' }}</span>
            </div>
          }
          <div class="summary-divider"></div>
          <div class="summary-row">
            <span>Subtotal</span>
            <span>{{ cartService.subtotal() | currency:'MXN':'symbol-narrow' }}</span>
          </div>
          <div class="summary-row">
            <span>Envio</span>
            <span>{{ cartService.shipping() === 0 ? 'Gratis' : (cartService.shipping() | currency:'MXN':'symbol-narrow') }}</span>
          </div>
          <div class="summary-row total">
            <span>Total</span>
            <span>{{ cartService.total() | currency:'MXN':'symbol-narrow' }}</span>
          </div>
          <p class="payment-note">Metodo de pago: Transferencia bancaria</p>
        </div>
      </div>
    }
  </div>
</div>
