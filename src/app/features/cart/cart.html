<div class="cart-page">
  <div class="container">
    <h1 class="page-title">Carrito de Compras</h1>

    @if (cartService.cartItems().length === 0) {
      <div class="empty-cart">
        <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="#ccc" stroke-width="1.5">
          <circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/>
          <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/>
        </svg>
        <p>Tu carrito esta vacio</p>
        <a routerLink="/tienda" class="btn-shop">Ir a la tienda</a>
      </div>
    } @else {
      <div class="cart-layout">
        <div class="cart-items">
          @for (item of cartService.cartItems(); track item.id_producto) {
            <div class="cart-item">
              <div class="item-image">
                <img [src]="item.imagen || 'assets/no-image.png'" [alt]="item.nombre">
              </div>
              <div class="item-info">
                <h3>{{ item.nombre }}</h3>
                <p class="item-price">{{ item.precio | currency:'MXN':'symbol-narrow' }}</p>
              </div>
              <div class="item-quantity">
                <button (click)="decrement(item.id_producto, item.cantidad)">-</button>
                <span>{{ item.cantidad }}</span>
                <button (click)="increment(item.id_producto, item.cantidad, item.stock)">+</button>
              </div>
              <div class="item-total">
                {{ item.precio * item.cantidad | currency:'MXN':'symbol-narrow' }}
              </div>
              <button class="btn-remove" (click)="remove(item.id_producto)">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/>
                </svg>
              </button>
            </div>
          }
        </div>

        <div class="cart-summary">
          <h3>Resumen del pedido</h3>
          <div class="summary-row">
            <span>Subtotal</span>
            <span>{{ cartService.subtotal() | currency:'MXN':'symbol-narrow' }}</span>
          </div>
          <div class="summary-row">
            <span>Envio</span>
            <span>
              @if (cartService.shipping() === 0) {
                Gratis
              } @else {
                {{ cartService.shipping() | currency:'MXN':'symbol-narrow' }}
              }
            </span>
          </div>
          @if (cartService.subtotal() < 1000 && cartService.cartItems().length > 0) {
            <p class="shipping-note">Envio gratis en compras mayores a $1,000</p>
          }
          <div class="summary-row total">
            <span>Total</span>
            <span>{{ cartService.total() | currency:'MXN':'symbol-narrow' }}</span>
          </div>
          <a routerLink="/checkout" class="btn-checkout">Proceder al pago</a>
        </div>
      </div>
    }
  </div>
</div>
