<div class="cart-page">
  <div class="container">
    <h1 class="page-title"><i class="fas fa-shopping-cart"></i> Carrito de Compras</h1>

    @if (cartService.cartItems().length === 0) {
      <div class="empty-cart">
        <i class="fas fa-shopping-cart"></i>
        <p>Tu carrito está vacío</p>
        <a routerLink="/tienda" class="btn-shop"><i class="fas fa-store"></i> Ir a la tienda</a>
      </div>
    } @else {
      <div class="cart-layout">
        <div class="cart-items">
          @for (item of cartService.cartItems(); track item.id_producto) {
            <div class="cart-item">
              <div class="item-image">
                <img [src]="item.imagen || 'no-image.png'" [alt]="item.nombre">
              </div>
              <div class="item-info">
                <h3>{{ item.nombre }}</h3>
                <p class="item-price">{{ item.precio | currency:'MXN':'symbol-narrow' }}</p>
              </div>
              <div class="item-quantity">
                <button (click)="decrement(item.id_producto, item.cantidad)">-</button>
                <span>{{ item.cantidad }}</span>
                <button (click)="increment(item.id_producto, item.cantidad, item.stock)">+</button>
              </div>
              <div class="item-total">
                {{ item.precio * item.cantidad | currency:'MXN':'symbol-narrow' }}
              </div>
              <button class="btn-remove" (click)="remove(item.id_producto)" title="Eliminar">
                <i class="fas fa-trash-alt"></i>
              </button>
            </div>
          }
        </div>

        <div class="cart-summary">
          <h3>Resumen del pedido</h3>
          <div class="summary-row">
            <span>Subtotal</span>
            <span>{{ cartService.subtotal() | currency:'MXN':'symbol-narrow' }}</span>
          </div>
          <div class="summary-row">
            <span>Envío</span>
            <span>
              @if (cartService.shipping() === 0) { <span class="free-shipping">Gratis</span> }
              @else { {{ cartService.shipping() | currency:'MXN':'symbol-narrow' }} }
            </span>
          </div>
          @if (cartService.subtotal() < 1000 && cartService.cartItems().length > 0) {
            <p class="shipping-note"><i class="fas fa-truck"></i> Envío gratis en compras mayores a $1,000</p>
          }
          <div class="summary-divider"></div>
          <div class="summary-row total">
            <span>Total</span>
            <span>{{ cartService.total() | currency:'MXN':'symbol-narrow' }}</span>
          </div>
          <a routerLink="/checkout" class="btn-checkout">
            <i class="fas fa-lock"></i> Proceder al pago
          </a>
        </div>
      </div>
    }
  </div>
</div>
